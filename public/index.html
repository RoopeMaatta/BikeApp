<!--  -->
<!-- Description: Primary structure and contents of webpage    -->
<!--  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Find Trips</title>
</head>
<body>
 <!-- Input fields for parameters -->
<div>
  <input id="departureStationIds" type="text" placeholder="Departure station IDs (comma-separated)">
  <input id="returnStationIds" type="text" placeholder="Return station IDs (comma-separated)">
  <input id="departureTime" type="text" placeholder="Departure time (yyyy-mm-dd)">
  <input id="returnTime" type="text" placeholder="Return time (yyyy-mm-dd)">
  <input id="coveredDistanceMeters" type="text" placeholder="Covered distance (meters)">
  <input id="durationSeconds" type="text" placeholder="Duration (seconds)">
</div>

<!-- Find Trips button -->
<button id="findTripsButton">Find Trips</button>

<!-- Results div -->
<div id="results"></div>

  <script>

document.getElementById('findTripsButton').addEventListener('click', function() {
 
 // Create a new URL object
 let url = new URL('/api/findTrips', window.location.origin);

 // Gather user input into params object
 let params = {};

 let departureStationIdsInput = document.getElementById('departureStationIds').value;
 let returnStationIdsInput = document.getElementById('returnStationIds').value;
 let departureTimeInput = document.getElementById('departureTime').value;
 let returnTimeInput = document.getElementById('returnTime').value;
 let coveredDistanceMetersInput = document.getElementById('coveredDistanceMeters').value;
 let durationSecondsInput = document.getElementById('durationSeconds').value;

 if (departureStationIdsInput) {
   params.departureStationIds = departureStationIdsInput.split(',').map(Number);
 }
 if (returnStationIdsInput) {
   params.returnStationIds = returnStationIdsInput.split(',').map(Number);
 }
 if (departureTimeInput) {
   params.departureTime = departureTimeInput;
 }
 if (returnTimeInput) {
   params.returnTime = returnTimeInput;
 }
 if (coveredDistanceMetersInput) {
   params.coveredDistanceMeters = Number(coveredDistanceMetersInput);
 }
 if (durationSecondsInput) {
   params.durationSeconds = Number(durationSecondsInput);
 }

 console.log('Initial url:', url);
 console.log('Initial params:', params);
 
// Add each parameter to the URL
for (let key in params) {
  if (Array.isArray(params[key])) {
    params[key].forEach(value => url.searchParams.append(key + '[]', value));
  } else {
    url.searchParams.append(key, params[key]);
  }
}


 console.log('Final url:', url);

 fetch(url, {
   method: 'GET',
   headers: {
     'Content-Type': 'application/json',
   },
 })
 .then(response => {
   console.log('Response received:', response);
   return response.json();
 })
 .then(data => {
   console.log('Data received:', data);
   if (data.errors) {
       console.log('Error details:', data.errors);
   } else {
     // Get a reference to the results div
     let resultsDiv = document.getElementById('results');

     // Clear the current contents of the results div
     resultsDiv.innerHTML = '';

     // Convert each item in the data array into a paragraph and append it to the results div
     data.forEach(item => {
       let p = document.createElement('p');
       p.textContent = JSON.stringify(item);
       resultsDiv.appendChild(p);
     });
   }
 })
 .catch((error) => {
   console.error('Error:', error);
 });
});








  </script>

  
</body>
</html>